"use strict";(self.webpackChunkskypath_ios_sdk=self.webpackChunkskypath_ios_sdk||[]).push([[6525],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>m});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),u=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=u(r),h=n,m=p["".concat(s,".").concat(h)]||p[h]||c[h]||i;return r?a.createElement(m,l(l({ref:t},d),{},{components:r})):a.createElement(m,l({ref:t},d))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,l=new Array(i);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[p]="string"==typeof e?e:n,l[1]=o;for(var u=2;u<i;u++)l[u]=r[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}h.displayName="MDXCreateElement"},3312:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=r(7462),n=(r(7294),r(3905));const i={sidebar_position:9},l="Notifications",o={unversionedId:"Advanced/Alerts",id:"version-2.2.0/Advanced/Alerts",title:"Notifications",description:"Overview",source:"@site/versioned_docs/version-2.2.0/Advanced/Alerts.md",sourceDirName:"Advanced",slug:"/Advanced/Alerts",permalink:"/skypath-ios-sdk-docs/docs/Advanced/Alerts",draft:!1,tags:[],version:"2.2.0",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"Logs",permalink:"/skypath-ios-sdk-docs/docs/Basic/Logs"},next:{title:"Nowcasting",permalink:"/skypath-ios-sdk-docs/docs/Advanced/Nowcast"}},s={},u=[{value:"Overview",id:"overview",level:3},{value:"Tech Algo",id:"tech-algo",level:3},{value:"H3 Indexes",id:"h3-indexes",level:5},{value:"Turbulence Reports",id:"turbulence-reports",level:5},{value:"Filter Turbulence",id:"filter-turbulence",level:5},{value:"Notify Nearest",id:"notify-nearest",level:5},{value:"Alert logic",id:"alert-logic",level:5},{value:"Query",id:"query",level:3},{value:"Manually",id:"manually",level:5},{value:"Automatic",id:"automatic",level:5},{value:"Test",id:"test",level:3}],d={toc:u},p="wrapper";function c(e){let{components:t,...i}=e;return(0,n.kt)(p,(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"notifications"},"Notifications"),(0,n.kt)("h3",{id:"overview"},"Overview"),(0,n.kt)("p",null,"Alerts will be searched in locally cached data received per the ",(0,n.kt)("inlineCode",{parentName:"p"},"SkyPath.dataQuery")," configuration. No server request will be made here. "),(0,n.kt)("p",null,"Observed turbulence reports will be used that were fetched within specified route corridor (polygon) and/or viewport in ",(0,n.kt)("inlineCode",{parentName:"p"},"SkyPath.dataQuery"),". If reports are not available in some area the alerts will be searched in fetched turbulence polygons if it is available."),(0,n.kt)("h3",{id:"tech-algo"},"Tech Algo"),(0,n.kt)("p",null,"Here is the high-level explanation of the algorithm that is used to search turbulence to notify."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Algo",src:r(9317).Z+"#gh-light-mode-only",width:"2000",height:"648"}),(0,n.kt)("img",{alt:"Algo",src:r(225).Z+"#gh-dark-mode-only",width:"2000",height:"648"})),(0,n.kt)("h5",{id:"h3-indexes"},"H3 Indexes"),(0,n.kt)("p",null,"Generate an array of H3 indexes in corresponding altitudes to search turbulence to notify in."),(0,n.kt)("h5",{id:"turbulence-reports"},"Turbulence Reports"),(0,n.kt)("p",null,"Get observed turbulence reports in corresponding H3 indexes and altitudes. Each report has an H3 index and altitude block (in 1,000 ft)."),(0,n.kt)("h5",{id:"filter-turbulence"},"Filter Turbulence"),(0,n.kt)("p",null,"Filter found reports by specified criteria:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"history time (ts)"),(0,n.kt)("li",{parentName:"ul"},"min severity (sev)")),(0,n.kt)("h5",{id:"notify-nearest"},"Notify Nearest"),(0,n.kt)("p",null,"Take and notify on the nearest report based on the distance to and altitude difference from the current altitude. Other reports could be grouped into clusters and visualized. "),(0,n.kt)("h5",{id:"alert-logic"},"Alert logic"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Distance ahead - 100NM"),(0,n.kt)("li",{parentName:"ul"},"Vertical span - 4 altitude blocks (4,000 ft total), example at FL380 would be FL360..<FL400"),(0,n.kt)("li",{parentName:"ul"},"Route mode - If there\u2019s a route in place then: ",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"40 NM total width around the route"),(0,n.kt)("li",{parentName:"ul"},"Similar vertical span corridor on the entire route including climb and descent"))),(0,n.kt)("li",{parentName:"ul"},"Beam mode - If not, go into beam mode",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"15 degrees horizontal span"),(0,n.kt)("li",{parentName:"ul"},"Similar vertical span")))),(0,n.kt)("h3",{id:"query"},"Query"),(0,n.kt)("p",null,"By default, SDK will use a predefined configuration for searching turbulence alerts, see ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," for more details. So it will be a good start to use the default values of ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery()"),"."),(0,n.kt)("p",null,"There are 2 ways to get turbulence alerts:"),(0,n.kt)("h5",{id:"manually"},"Manually"),(0,n.kt)("p",null,"Manually when needed. For example, on every location update, or by time intervals or distance passed. This will have all currently found turbulence alerts despite whether they were found in the previous query. "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-swift"},"let query = AlertQuery(altRange: altRange, route: route?.coordinates)\nlet result = SkyPath.shared.alerts(with: query)\n")),(0,n.kt)("p",null,"It blocks the current thread, so using a separate background thread is recommended."),(0,n.kt)("h5",{id:"automatic"},"Automatic"),(0,n.kt)("p",null,"Automatic monitoring. SDK will check for turbulence on every new location update. When found, an alert will be reported via ",(0,n.kt)("inlineCode",{parentName:"p"},"SkyPathDelegate.didReceiveAlert(alert:)"),". This will not report the same turbulence alert multiple times in a row, but it could report the same alert that was reported previously if there were other alerts in between. So it will report only once in cases A1 A1 A1 A1 but will report 3 times in cases A1, A2, and A1."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-swift"},"let query = AlertQuery(altRange: altRange, route: route?.coordinates)\nSkyPath.shared.startMonitoringAlerts(with: query)\n")),(0,n.kt)("p",null,"When the ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," changes you can call only ",(0,n.kt)("inlineCode",{parentName:"p"},"startMonitoringAlerts(with:)")," with a new query without stopping it first."),(0,n.kt)("p",null,"Based on the ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," properties, SDK filters server reports. All ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," properties have default values. Configure it per your needs."),(0,n.kt)("p",null,"There are two modes: route and beam."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Route mode is used when route line coordinates or a polygon are set in the query. It can use polygon or route line coordinates and width around to make a corridor.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Beam mode is used when no route is provided. It is configured by angle span, and distance from the current location."))),(0,n.kt)("p",null,"When you get a turbulence alert you can show it in the app with the local iOS notification if the app is in the background. Let SDK know that notification has been presented by:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-swift"},"SkyPath.shared.alertedTurbulenceSeverity(sev)\n")),(0,n.kt)("p",null,"It is safe to call ",(0,n.kt)("inlineCode",{parentName:"p"},"startMonitoringAlerts")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"stopMonitoringAlerts")," multiple times. However, it works as enable disable, so no need to call it again after starting monitoring until it stops monitoring and needs to start again. You can also check ",(0,n.kt)("inlineCode",{parentName:"p"},"SkyPath.shared.isMonitoringAlerts")," if need to call ",(0,n.kt)("inlineCode",{parentName:"p"},"startMonitoringAlerts")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"stopMonitoringAlerts"),"."),(0,n.kt)("h3",{id:"test"},"Test"),(0,n.kt)("p",null,"To test the notification you need to simulate a flight towards some turbulence area that meets ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," criteria (see the SDK API docs for more details), so the turbulence reports will be in the query corridor altitude, proper severity, etc. The following will describe the simple steps for testing using the default ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," parameters. "),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Find on the map some turbulence hexagons with a Moderate severity level at an altitude of, for example, ~38,000 ft.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Simulate a flight to fly at ~38,000 ft (same hexagon turbulence report altitude, so report will be within searching altitude corridor) towards that Moderate turbulence hexagon on a distance of more than 100 NM, for example, 150-200 NM.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"By default, turbulence alerts are searched in a beam mode within 100 NM ahead, so when you fly at a distance closer than 100 NM the hexagon turbulence will be in range. Make sure that based on the current speed, it will require at least a few minutes to cover this distance.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The turbulence notification should arrive. "))),(0,n.kt)("p",null,"These quick steps are valid if the default query parameters are used. Please take into account any customizations you made in ",(0,n.kt)("inlineCode",{parentName:"p"},"AlertQuery")," for testing. For example, if the severity to alert is set to Moderate-Severity and above, you'll need to find a corresponding Moderate-Severity hexagon and so on."))}c.isMDXComponent=!0},225:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/alert_algo_dark-c6db817131f3bf0be502a27af82d9e55.png"},9317:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/alert_algo_light-4cd6703390b9f943884adc2df0e56846.png"}}]);